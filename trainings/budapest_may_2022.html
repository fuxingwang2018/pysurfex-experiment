
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ACCORD training Budapest May 9-13 20222 &#8212; Pysurfex-experiment  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pysurfex-experiment  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ACCORD training Budapest May 9-13 20222</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="accord-training-budapest-may-9-13-20222">
<h1>ACCORD training Budapest May 9-13 20222<a class="headerlink" href="#accord-training-budapest-may-9-13-20222" title="Permalink to this headline">¶</a></h1>
<section id="pysurfex-command-line-exercises">
<h2>pySurfex command line exercises<a class="headerlink" href="#pysurfex-command-line-exercises" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Assume pysurfex is installed and in your path</p></li>
<li><p>Assume pysurfex installation directory is “path-to-pysurfex”</p></li>
<li><p>Assume that you have your surfex binaries in PATH and that they are called PGD, PREP, OFFLINE and SODA</p></li>
<li><p>Assume that you have system paths defined in a file called system.json</p></li>
<li><p>Assume a domain defined in a file called domain.json</p></li>
</ul>
</section>
<section id="outline">
<h2>Outline<a class="headerlink" href="#outline" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>create offline forcing from netCDF and grib files using pySurfex create_forcing</p></li>
<li><p>create PREP file</p></li>
<li><p>Run OFFLINE</p></li>
<li><p>Prepare screen level and satellite observations for assimilation in Soda</p></li>
</ul>
</section>
<section id="create-offline-forcing">
<h2>Create offline forcing<a class="headerlink" href="#create-offline-forcing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir hm_sfx
<span class="nb">cd</span> hm_sfx
mkdir forcing
<span class="nb">cd</span> forcing
create_forcing <span class="m">2021060500</span> <span class="m">2021060503</span> -d examples/domains/drammen.json -p forcingdir/FORCING_@YYYY@@MM@@DD@T@HH@Z.nc --zsoro_converter none -i surfex --rain_converter none --wind_converter none --wind_dir_converter none -ig examples/domains/met_nordic.json
</pre></div>
</div>
</section>
<section id="create-prep-file">
<h2>Create PREP file<a class="headerlink" href="#create-prep-file" title="Permalink to this headline">¶</a></h2>
</section>
<section id="run-offline">
<h2>Run OFFLINE<a class="headerlink" href="#run-offline" title="Permalink to this headline">¶</a></h2>
</section>
<section id="prepare-screen-level-observations-t2m-rh2m-and-snow-depth">
<h2>Prepare screen level observations (t2m, rh2m and snow depth)<a class="headerlink" href="#prepare-screen-level-observations-t2m-rh2m-and-snow-depth" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p nobackup/trainingData
mkdir -p nobackup/obsOutput
<span class="nb">cd</span> nobackup/trainingData
untar ObHandling.tar
<span class="c1">#ob2021060506 (bufr file)</span>
<span class="c1">#first_guess_gridpp_grib (atmosphere FG file)</span>
<span class="c1">#first_guess_sfx_gridpp_grib (surface FG file)</span>
<span class="c1">#Const.Clim.sfx.grib</span>
<span class="c1">#PGD.nc</span>
<span class="c1">#Sentinel_2021060506.nc</span>
<span class="c1">#first_guess.yml</span>
<span class="c1">#config.json</span>
<span class="c1">#config_sentinel.json</span>
<span class="c1">#drammen.json</span>
</pre></div>
</div>
</section>
<section id="bufr2json">
<h2>bufr2json<a class="headerlink" href="#bufr2json" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create observation file in json format from bufr file</span>
<span class="nb">cd</span> hm_sfx
mkdir obHandling
<span class="nb">cd</span> obHandling

bufr2json -b /nobackup/trainingData/ob2021060506 -v airTemperatureAt2M relativeHumidityAt2M totalSnowDepth -o /nobackup/ObHandlingOutput/ob2021060506.json -dtg <span class="m">2021060506</span> -range <span class="m">1800</span>
</pre></div>
</div>
</section>
<section id="firstguess4gridpp">
<h2>FirstGuess4gridpp<a class="headerlink" href="#firstguess4gridpp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create first guess netCDF file for the model equivalent variables:</span>
<span class="c1"># Set paths to input and output files</span>
<span class="nv">raw</span><span class="o">=</span>/nobackup/obsOutput/FirstGuess4Gridpp.nc
<span class="nv">climfile</span><span class="o">=</span>/nobackup/trainingData/Const.Clim.sfx.grib
<span class="nv">fg_ua</span><span class="o">=</span>/nobackup/trainingData/first_guess_gridpp_grib
<span class="nv">fg_sfx</span><span class="o">=</span>/nobackup/trainingData/first_guess_sfx_gridpp_grib
<span class="nv">DTG</span><span class="o">=</span><span class="m">2021060506</span>


FirstGuess4gridpp -dtg <span class="nv">$DTG</span> <span class="se">\</span>
-c /nobackup/trainingData/first_guess.yml <span class="se">\</span>
-i <span class="nv">$fg_ua</span> <span class="se">\</span>
-if grib2 <span class="se">\</span>
-d /nobackup/trainingData/drammen.json <span class="se">\</span>
-sd_file <span class="nv">$fg_sfx</span> <span class="se">\</span>
-sd_format grib1 <span class="se">\</span>
--sd_converter sdp <span class="se">\</span>
-altitude_file <span class="nv">$fg_ua</span> <span class="se">\</span>
-altitude_format grib2 <span class="se">\</span>
--altitude_converter phi2m <span class="se">\</span>
-laf_file <span class="nv">$climfile</span>  <span class="se">\</span>
-laf_format grib1 <span class="se">\</span>
--laf_converter sea2land <span class="se">\</span>
air_temperature_2m relative_humidity_2m surface_snow_thickness <span class="se">\</span>
-o <span class="nv">$raw</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>

<span class="c1"># This creates the file FirstGuess4Gridpp.nc</span>
</pre></div>
</div>
</section>
<section id="titan-and-gridpp">
<h2>titan and gridPP<a class="headerlink" href="#titan-and-gridpp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quality control and optimal interpolation of the observed values</span>
<span class="c1"># NB remember to set the correct paths in the config.json file!!</span>

titan --domain /nobackup/trainingData/drammen.json -i config.json -dtg <span class="m">2021060506</span> -v rh2m -o /nobackup/obsOutput/qc_obs_rh2m.json domain nometa redundancy plausibility fraction firstguess

<span class="c1"># This creates the file qc_obs_t2m.json, repeat the process for rh2m and sd</span>

gridpp -i /nobackup/obsOp_output/FirstGuess4Gridpp.nc --obs /nobackup/obsOutput/qc_obs_t2m.json -o /nobackup/obsOutput/an_t2m.nc -v air_temperature_2m -hor <span class="m">35000</span> -vert <span class="m">200</span> --elevGradient -0.0065

<span class="c1"># This creates the analysis file an_t2m.nc, repeat the process for rh2m and sd</span>
</pre></div>
</div>
</section>
<section id="oi2soda">
<h2>oi2soda<a class="headerlink" href="#oi2soda" title="Permalink to this headline">¶</a></h2>
</section>
<section id="prepare-satellite-derived-soil-moisture-observations-using-pysurfex">
<h2>Prepare satellite derived soil moisture observations using pySurfex<a class="headerlink" href="#prepare-satellite-derived-soil-moisture-observations-using-pysurfex" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># FirstGuess4gridpp</span>
<span class="c1"># Define paths to input and output data</span>
<span class="nv">raw</span><span class="o">=</span>/nobackup/obsOp_output/FirstGuess4GridppSM.nc
<span class="nv">climfile</span><span class="o">=</span>/nobackup/trainingData/PGD.nc
<span class="nv">fg_ua</span><span class="o">=</span>/nobackup/trainingData/first_guess_gridpp_grib
<span class="nv">fg_sfx</span><span class="o">=</span>/nobackup/trainingData/first_guess_sfx_gridpp_grib
<span class="nv">DTG</span><span class="o">=</span><span class="m">2021060506</span>

FirstGuess4gridpp -dtg <span class="nv">$DTG</span> <span class="se">\</span>
   -c /nobackup/trainingData/first_guess.yml <span class="se">\</span>
   -i <span class="nv">$fg_ua</span> <span class="se">\</span>
   -if grib2 <span class="se">\</span>
   -d /nobackup/trainingData/drammen.json <span class="se">\</span>
   -sm_file <span class="nv">$fg_sfx</span> <span class="se">\</span>
   -sm_format grib1 <span class="se">\</span>
   --sm_converter smp <span class="se">\</span>
   -altitude_file <span class="nv">$fg_ua</span> <span class="se">\</span>
   -altitude_format grib2 <span class="se">\</span>
   --altitude_converter phi2m <span class="se">\</span>
   -laf_file <span class="nv">$climfile</span>  <span class="se">\</span>
   --laf_converter sea2land <span class="se">\</span>
   -laf_format surfex <span class="se">\</span>
   surface_soil_moisture <span class="se">\</span>
   -o <span class="nv">$raw</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</div>
</section>
<section id="sentinel-obs">
<h2>sentinel_obs<a class="headerlink" href="#sentinel-obs" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create json file for titan and gridpp</span>

sentinel_obs --varname surface_soil_moisture -fg /nobackup/obsOutput/FirstGuess4GridppSM.nc -i /nobackup/trainingData/Sentinel_SM_20210606.nc -o sentinel_obs.json
</pre></div>
</div>
</section>
<section id="titan">
<h2>titan<a class="headerlink" href="#titan" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Quality control of observations</span>

titan --domain /nobackup/trainingData/drammen.json -i /nobackup/obsOutput/config_sentinel.json -dtg <span class="m">2021060506</span> -v surface_soil_moisture -o /nobackup/obsOutput/qc_sentinel.json domain nometa redundancy plausibility fraction firstguess
</pre></div>
</div>
</section>
<section id="gridpp">
<h2>gridPP<a class="headerlink" href="#gridpp" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># gridPP</span>

gridpp -i /nobackup/obsOutput/FirstGuess4GridppSM.nc --obs /nobackup/obsOutput/qc_sentinel.json -o /nobackup/obsOutput/an_sm.nc -v surface_soil_moisture -hor <span class="m">1000</span> -vert <span class="m">200</span> --elevGradient -0.0065
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">ACCORD training Budapest May 9-13 20222</a><ul>
<li><a class="reference internal" href="#pysurfex-command-line-exercises">pySurfex command line exercises</a></li>
<li><a class="reference internal" href="#outline">Outline</a></li>
<li><a class="reference internal" href="#create-offline-forcing">Create offline forcing</a></li>
<li><a class="reference internal" href="#create-prep-file">Create PREP file</a></li>
<li><a class="reference internal" href="#run-offline">Run OFFLINE</a></li>
<li><a class="reference internal" href="#prepare-screen-level-observations-t2m-rh2m-and-snow-depth">Prepare screen level observations (t2m, rh2m and snow depth)</a></li>
<li><a class="reference internal" href="#bufr2json">bufr2json</a></li>
<li><a class="reference internal" href="#firstguess4gridpp">FirstGuess4gridpp</a></li>
<li><a class="reference internal" href="#titan-and-gridpp">titan and gridPP</a></li>
<li><a class="reference internal" href="#oi2soda">oi2soda</a></li>
<li><a class="reference internal" href="#prepare-satellite-derived-soil-moisture-observations-using-pysurfex">Prepare satellite derived soil moisture observations using pySurfex</a></li>
<li><a class="reference internal" href="#sentinel-obs">sentinel_obs</a></li>
<li><a class="reference internal" href="#titan">titan</a></li>
<li><a class="reference internal" href="#gridpp">gridPP</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/trainings/budapest_may_2022.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">Pysurfex-experiment  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ACCORD training Budapest May 9-13 20222</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Trygve Aspelien.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>